# AdminPlus 功能说明文档

## 1. 后端增强功能

### 1.1 权限控制
所有 Controller 方法已添加 `@PreAuthorize` 权限注解，支持细粒度的权限控制。

**权限列表：**
- `user:*` - 用户管理权限（list, query, add, edit, delete, assign）
- `role:*` - 角色管理权限（list, query, add, edit, delete, assign）
- `menu:*` - 菜单管理权限（list, query, add, edit, delete）
- `dict:*` - 字典管理权限（list, query, add, edit, delete）
- `dictitem:*` - 字典项管理权限（list, query, add, edit, delete）

**使用示例：**
```java
@PreAuthorize("hasAuthority('user:add')")
@PostMapping
public ApiResponse<UserVO> createUser(@Valid @RequestBody UserCreateReq req) {
    // ...
}
```

### 1.2 字典管理模块
实现了完整的字典管理功能，包括字典和字典项的增删改查。

**实体类：**
- `DictEntity` - 字典实体
- `DictItemEntity` - 字典项实体

**DTO/VO（使用 record 类型）：**
- `DictCreateReq` - 字典创建请求
- `DictUpdateReq` - 字典更新请求
- `DictVO` - 字典视图对象
- `DictItemCreateReq` - 字典项创建请求
- `DictItemUpdateReq` - 字典项更新请求
- `DictItemVO` - 字典项视图对象

**Service 接口：**
- `DictService` - 字典服务
- `DictItemService` - 字典项服务

**Controller：**
- `DictController` - 字典控制器（路径：`/sys/dicts`）
- `DictItemController` - 字典项控制器（路径：`/sys/dicts/{dictId}/items`）

### 1.3 Excel 导入导出
提供了 `ExcelUtils` 工具类，支持简单的 Excel 导入导出功能。

**使用示例：**
```java
// 导出
ExcelUtils.exportExcel(response, dataList, "用户列表", UserVO.class);

// 导入
List<UserVO> users = ExcelUtils.importExcel(file, UserVO.class);
```

### 1.4 缓存支持
使用 Spring Cache 实现缓存功能，默认使用 `ConcurrentMapCacheManager`。

**缓存配置：**
```java
@Configuration
@EnableCaching
public class CacheConfig {
    @Bean
    public CacheManager cacheManager() {
        return new ConcurrentMapCacheManager(
            "dict", "dictItem", "user", "role", "menu"
        );
    }
}
```

**使用示例：**
```java
@Cacheable(value = "dict", key = "'type:' + #dictType")
public DictVO getDictByType(String dictType) {
    // ...
}

@CacheEvict(value = "dict", allEntries = true)
public DictVO createDict(DictCreateReq req) {
    // ...
}
```

## 2. 前端增强功能

### 2.1 权限指令
实现了 `v-auth` 自定义指令，用于控制按钮和菜单的显示。

**使用示例：**
```vue
<el-button v-auth="'user:add'">新增用户</el-button>
<el-button v-auth="'user:edit'">编辑用户</el-button>
<el-button v-auth="'user:delete'">删除用户</el-button>
```

**注册方式：**
```javascript
// main.js
import { setupDirectives } from './directives'
setupDirectives(app)
```

### 2.2 字典管理页面
创建了完整的字典管理页面，支持字典和字典项的增删改查。

**页面路径：** `/system/dict`

**功能特性：**
- 字典列表查询
- 字典新增/编辑/删除
- 字典状态切换
- 搜索和分页
- 权限控制

### 2.3 字典数据管理 Store
实现了 `useDictStore`，提供字典数据的缓存和管理功能。

**使用示例：**
```javascript
import { useDictStore } from '@/stores/dict'

const dictStore = useDictStore()

// 获取字典项
const items = await dictStore.getDictItems('sys_user_sex')

// 获取字典标签
const label = dictStore.getDictLabel('sys_user_sex', '1')

// 刷新字典
await dictStore.refreshDict('sys_user_sex')
```

### 2.4 防抖节流工具函数
提供了防抖和节流工具函数，用于优化性能。

**防抖函数：**
```javascript
import { debounce } from '@/utils/debounce'

const handleSearch = debounce(() => {
  console.log('搜索')
}, 300)
```

**节流函数：**
```javascript
import { throttle } from '@/utils/throttle'

const handleScroll = throttle(() => {
  console.log('滚动')
}, 100)
```

## 3. 部署配置

### 3.1 Docker 部署

#### 后端 Dockerfile
使用多阶段构建，优化镜像大小。

```bash
cd backend
docker build -t adminplus-backend:latest .
```

#### 前端 Dockerfile
使用多阶段构建，基于 nginx 提供静态文件服务。

```bash
cd frontend
docker build -t adminplus-frontend:latest .
```

### 3.2 Docker Compose

使用 `docker-compose.yml` 一键启动所有服务。

```bash
cd AdminPlus
docker-compose up -d
```

**服务说明：**
- `postgres` - PostgreSQL 数据库（端口：5432）
- `backend` - 后端服务（端口：8080）
- `frontend` - 前端服务（端口：80）

### 3.3 Nginx 配置

**配置文件：** `frontend/nginx.conf`

**功能特性：**
- 静态资源缓存
- API 代理转发
- SPA 路由支持
- Gzip 压缩

## 4. 开发规范遵守情况

### 4.1 后端规范
- ✅ DTO/VO 使用 record 类型
- ✅ Service 方法添加 @Transactional
- ✅ 统一异常处理和响应格式
- ✅ Controller 添加 @PreAuthorize 权限注解
- ✅ 使用 Spring Cache 实现缓存
- ✅ 包结构规范

### 4.2 前端规范
- ✅ 组件使用 `<script setup>` 语法
- ✅ 变量使用 const 声明
- ✅ Store 使用 Setup Store
- ✅ 遵循目录结构规范
- ✅ 遵循命名规范

## 5. 快速开始

### 5.1 本地开发

**后端启动：**
```bash
cd backend
mvn spring-boot:run
```

**前端启动：**
```bash
cd frontend
npm install
npm run dev
```

### 5.2 Docker 部署

```bash
cd AdminPlus
docker-compose up -d
```

访问地址：
- 前端：http://localhost
- 后端：http://localhost:8080
- Swagger：http://localhost:8080/swagger-ui.html

### 5.3 默认账号

- 用户名：`admin`
- 密码：`admin123`

## 6. 注意事项

1. **缓存：** 当前使用内存缓存，生产环境建议使用 Redis
2. **Excel：** 当前 Excel 功能较为简单，如需复杂功能可使用 EasyExcel
3. **权限：** 权限数据需要在数据库中配置，参考 `data.sql`
4. **虚拟线程：** 已启用虚拟线程，适合 IO 密集型任务
5. **JDK 版本：** 必须使用 JDK 21+